import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from dateutil import parser

dataset=pd.read_csv("appData10.csv")
dataset.head()

dataset.info()
dataset.describe()

dataset["hour"]=dataset["hour"].str.slice(1,3).astype(int)

dataset.head(10)

dataset2=dataset.copy().drop(columns=['user','screen_list' ,'enrolled','enrolled_date','first_open'],axis=1)
dataset2.head()

plt.suptitle('Histogram',fontsize=20)
for i in range(1,dataset2.shape[1]+1):
    plt.subplot(3,3,i)
    f=plt.gca()
    f.set_title(dataset2.columns.values[i-1])
    vals=np.size(dataset2.iloc[:,i-1].unique())
   
dataset2.corrwith(dataset.enrolled).plot.bar(figsize=(20,20),title="Correlation")

corr=dataset2.corr()
corr

dataset.dtypes

dataset["first_open"]=[parser.parse(row_data) for row_data in dataset["first_open"]]

dataset["enrolled_date"]=[parser.parse(row_data) if isinstance(row_data,str) else row_data for row_data in dataset["enrolled_date"]]

dataset.dtypes

dataset["difference"]=(dataset["enrolled_date"]-dataset["first_open"]).astype("timedelta64[h]")

dataset.head(10)

#Conversion to enrolled from free trial

plt.hist(dataset["difference"].dropna())
plt.title("Distribution of time since enrolled")
plt.show()

dataset=dataset.drop(columns=["difference","first_open","enrolled_date","screen_list"],axis=1)

response=dataset["enrolled"]
dataset=dataset.drop(columns="enrolled")

from sklearn.model_selection import train_test_split
x_train,x_test,y_train,y_test=train_test_split(dataset,response,test_size=0.2)
print(x_train.shape)
print(y_train.shape)
print(x_test.shape)

dataset.columns.values

dataset.index.values

from sklearn.linear_model import LogisticRegression
logit=LogisticRegression()
logit.fit(x_train,y_train)
y_pred=logit.predict(x_test)

from sklearn.metrics import classification_report,confusion_matrix
print(classification_report(y_test,y_pred))

cm=confusion_matrix(y_test,y_pred)
print(cm)

df_cm=pd.DataFrame(cm,index=(0,1),columns=(0,1))
plt.figure(figsize=(10,7))
sns.heatmap(df_cm,annot=True,fmt='g')

from sklearn.model_selection import cross_val_score
accuracies=cross_val_score(estimator=logit,X=x_train,y=y_train,cv=5)
print(accuracies.mean())

final_results=pd.DataFrame(columns=["Customer_id","Actual result","Predicted result"])
final_results["Customer_id"]=x_test["user"]
final_results["Actual result"]=y_test
final_results["Predicted result"]=y_pred
#final_results.columns
final_results.head(20).reset_index()


